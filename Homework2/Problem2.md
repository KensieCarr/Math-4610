# Homework 2

## Problem 2


**Routine Name:**           Approximation of Derivatives

**Author:** Kensie Carr

**Language:** C++

**Description/Purpose:** 
Due to finite precision of arithmetic problems can occur when approximating. In particular, one standard approximation for derivatives involves the definition
<p> 
    $f'(x)dx = \displaystyle \lim_{h \rightarrow} \dfrac{f(x+h)-f(x)}{h}$
</p>
The approximation for this is
<p> 
    $f'(x)dx \approx \dfrac{f(x+h)-f(x)}{h} $
</p>
This routine gives an approximation for functions and compares relative and absolute error to investigate this approximation as *h* tends to zero. 

**Input:**

<p>
    $f(x) = x^2$
    
    Value: 2
    
    $g(x) = x^2 + 2x + 1$
    
    Value: 1
    
    $k(x) = \sin(x)$
    
    Value: 0
</p>
**Output:** 

<pre>
Function:  f(x) = x^2
======================
h                         | exactSolution             | approx                    | relError                  | absError             
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1.0                       | 4                         | 5.0                       | 2.500000e-01              | 1.000000e+00             
0.5                       | 4                         | 4.5                       | 1.250000e-01              | 5.000000e-01             
0.25                      | 4                         | 4.25                      | 6.250000e-02              | 2.500000e-01             
0.125                     | 4                         | 4.125                     | 3.125000e-02              | 1.250000e-01             
0.0625                    | 4                         | 4.0625                    | 1.562500e-02              | 6.250000e-02             
0.03125                   | 4                         | 4.03125                   | 7.812500e-03              | 3.125000e-02             
0.015625                  | 4                         | 4.015625                  | 3.906250e-03              | 1.562500e-02             
0.0078125                 | 4                         | 4.0078125                 | 1.953125e-03              | 7.812500e-03             
0.00390625                | 4                         | 4.00390625                | 9.765625e-04              | 3.906250e-03             
0.001953125               | 4                         | 4.001953125               | 4.882812e-04              | 1.953125e-03             
0.0009765625              | 4                         | 4.0009765625              | 2.441406e-04              | 9.765625e-04             
0.00048828125             | 4                         | 4.00048828125             | 1.220703e-04              | 4.882812e-04             
0.000244140625            | 4                         | 4.000244140625            | 6.103516e-05              | 2.441406e-04             
0.0001220703125           | 4                         | 4.0001220703125           | 3.051758e-05              | 1.220703e-04             
6.103515625e-05           | 4                         | 4.00006103515625          | 1.525879e-05              | 6.103516e-05             
3.0517578125e-05          | 4                         | 4.000030517578125         | 7.629395e-06              | 3.051758e-05             
1.52587890625e-05         | 4                         | 4.0000152587890625        | 3.814697e-06              | 1.525879e-05             
7.62939453125e-06         | 4                         | 4.000007629394531         | 1.907349e-06              | 7.629395e-06             
3.814697265625e-06        | 4                         | 4.000003814697266         | 9.536743e-07              | 3.814697e-06             
1.9073486328125e-06       | 4                         | 4.000001907348633         | 4.768372e-07              | 1.907349e-06             
9.5367431640625e-07       | 4                         | 4.000000953674316         | 2.384186e-07              | 9.536743e-07             
4.76837158203125e-07      | 4                         | 4.000000476837158         | 1.192093e-07              | 4.768372e-07             
2.384185791015625e-07     | 4                         | 4.000000238418579         | 5.960464e-08              | 2.384186e-07             
1.1920928955078125e-07    | 4                         | 4.0000001192092896        | 2.980232e-08              | 1.192093e-07             
5.960464477539063e-08     | 4                         | 4.000000059604645         | 1.490116e-08              | 5.960464e-08             
2.9802322387695312e-08    | 4                         | 4.000000029802322         | 7.450581e-09              | 2.980232e-08             
1.4901161193847656e-08    | 4                         | 4.0                       | 0.000000e+00              | 0.000000e+00             
7.450580596923828e-09     | 4                         | 4.0                       | 0.000000e+00              | 0.000000e+00             
Function:  g(x) = x^2+2x+1
======================
h                         | exactSolution             | approx                    | relError                  | absError             
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1.0                       | 4                         | 5.0                       | 2.500000e-01              | 1.000000e+00             
0.5                       | 4                         | 4.5                       | 1.250000e-01              | 5.000000e-01             
0.25                      | 4                         | 4.25                      | 6.250000e-02              | 2.500000e-01             
0.125                     | 4                         | 4.125                     | 3.125000e-02              | 1.250000e-01             
0.0625                    | 4                         | 4.0625                    | 1.562500e-02              | 6.250000e-02             
0.03125                   | 4                         | 4.03125                   | 7.812500e-03              | 3.125000e-02             
0.015625                  | 4                         | 4.015625                  | 3.906250e-03              | 1.562500e-02             
0.0078125                 | 4                         | 4.0078125                 | 1.953125e-03              | 7.812500e-03             
0.00390625                | 4                         | 4.00390625                | 9.765625e-04              | 3.906250e-03             
0.001953125               | 4                         | 4.001953125               | 4.882812e-04              | 1.953125e-03             
0.0009765625              | 4                         | 4.0009765625              | 2.441406e-04              | 9.765625e-04             
0.00048828125             | 4                         | 4.00048828125             | 1.220703e-04              | 4.882812e-04             
0.000244140625            | 4                         | 4.000244140625            | 6.103516e-05              | 2.441406e-04             
0.0001220703125           | 4                         | 4.0001220703125           | 3.051758e-05              | 1.220703e-04             
6.103515625e-05           | 4                         | 4.00006103515625          | 1.525879e-05              | 6.103516e-05             
3.0517578125e-05          | 4                         | 4.000030517578125         | 7.629395e-06              | 3.051758e-05             
1.52587890625e-05         | 4                         | 4.0000152587890625        | 3.814697e-06              | 1.525879e-05             
7.62939453125e-06         | 4                         | 4.000007629394531         | 1.907349e-06              | 7.629395e-06             
3.814697265625e-06        | 4                         | 4.000003814697266         | 9.536743e-07              | 3.814697e-06             
1.9073486328125e-06       | 4                         | 4.000001907348633         | 4.768372e-07              | 1.907349e-06             
9.5367431640625e-07       | 4                         | 4.000000953674316         | 2.384186e-07              | 9.536743e-07             
4.76837158203125e-07      | 4                         | 4.000000476837158         | 1.192093e-07              | 4.768372e-07             
2.384185791015625e-07     | 4                         | 4.000000238418579         | 5.960464e-08              | 2.384186e-07             
1.1920928955078125e-07    | 4                         | 4.0000001192092896        | 2.980232e-08              | 1.192093e-07             
5.960464477539063e-08     | 4                         | 4.000000059604645         | 1.490116e-08              | 5.960464e-08             
2.9802322387695312e-08    | 4                         | 4.000000029802322         | 7.450581e-09              | 2.980232e-08             
1.4901161193847656e-08    | 4                         | 4.000000014901161         | 3.725290e-09              | 1.490116e-08            
7.450580596923828e-09     | 4                         | 4.0                       | 0.000000e+00              | 0.000000e+00             
3.725290298461914e-09     | 4                         | 4.0                       | 0.000000e+00              | 0.000000e+00             
Function:  k(x) = sin(x)
======================
h                         | exactSolution             | approx                    | relError                  | absError             
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1.0                       | 1                         | 0.841470984807529         | 1.585290e-01              | 1.585290e-01             
0.5                       | 1                         | 0.9588510772082373        | 4.114892e-02              | 4.114892e-02             
0.25                      | 1                         | 0.9896158370174817        | 1.038416e-02              | 1.038416e-02             
0.125                     | 1                         | 0.9973978670823271        | 2.602133e-03              | 2.602133e-03             
0.0625                    | 1                         | 0.999349085475842         | 6.509145e-04              | 6.509145e-04             
0.03125                   | 1                         | 0.9998372475311044        | 1.627525e-04              | 1.627525e-04             
0.015625                  | 1                         | 0.9999593103930238        | 4.068961e-05              | 4.068961e-05             
0.0078125                 | 1                         | 0.9999898275054875        | 1.017249e-05              | 1.017249e-05             
0.00390625                | 1                         | 0.9999974568709149        | 2.543130e-06              | 2.543130e-06             
0.001953125               | 1                         | 0.9999993642195477        | 6.357828e-07              | 6.357828e-07             
0.0009765625              | 1                         | 0.9999998410567059        | 1.589457e-07              | 1.589457e-07             
0.00048828125             | 1                         | 0.9999999602659955        | 3.973643e-08              | 3.973643e-08             
0.000244140625            | 1                         | 0.9999999900683179        | 9.934107e-09              | 9.934107e-09             
0.0001220703125           | 1                         | 0.9999999975188985        | 2.483527e-09              | 2.483527e-09             
6.103515625e-05           | 1                         | 0.9999999993815436        | 6.208817e-10              | 6.208817e-10             
3.0517578125e-05          | 1                         | 0.9999999998472049        | 1.552204e-10              | 1.552204e-10             
1.52587890625e-05         | 1                         | 0.9999999999636202        | 3.880507e-11              | 3.880507e-11             
7.62939453125e-06         | 1                         | 0.999999999992724         | 9.701240e-12              | 9.701240e-12             
3.814697265625e-06        | 1                         | 1.0                       | 2.425282e-12              | 2.425282e-12             
1.9073486328125e-06       | 1                         | 1.0                       | 6.062928e-13              | 6.062928e-13             
9.5367431640625e-07       | 1                         | 1.0                       | 1.515454e-13              | 1.515454e-13             
4.76837158203125e-07      | 1                         | 1.0                       | 3.785861e-14              | 3.785861e-14             
2.384185791015625e-07     | 1                         | 1.0                       | 9.436896e-15              | 9.436896e-15             
1.1920928955078125e-07    | 1                         | 1.0                       | 2.331468e-15              | 2.331468e-15             
5.960464477539063e-08     | 1                         | 1.0                       | 5.551115e-16              | 5.551115e-16             
2.9802322387695312e-08    | 1                         | 1.0                       | 1.110223e-16              | 1.110223e-16             
1.4901161193847656e-08    | 1                         | 1.0                       | 0.000000e+00              | 0.000000e+00             
7.450580596923828e-09     | 1                         | 1.0                       | 0.000000e+00              | 0.000000e+00             
</pre>

**Usage/Example:**

The derivative of our 
<p>
    $f'(x) = 2x$
</p>
if I put in the value of 2 then my expected solution should be 4. It takes 28 iterations until the computer can't tell that the error is getting smaller because of machine epsilon.

**Implementation/Code:** 
```python
def derivative(fn, h):
    return (fn(x+h) - fn(x))/h
    
def solveWithH(fn, expectedSolution, value, histKey):
    h1 = 1
    makeHistory(fn, h1, expectedSolution, value, histKey)
    h1 = h1/2
    makeHistory(fn, h1, expectedSolution, value, histKey)
    
    while (history[histKey][-1]['relError'] - history[histKey][-2]['relError'] != 0) or (history[histKey][-1]['absError'] - history[histKey][-2]['absError'] != 0):
        h1 = h1/2
        makeHistory(fn, h1, expectedSolution, value, histKey)
        
def makeHistory(fn, h, expectedSolution, value, histKey):
    if histKey not in history:
        history[histKey] = []
    history[histKey].append(dict())
    approx = derivative(fn, h).subs(x,value)
    history[histKey][-1]['h'] = h
    history[histKey][-1]['approx'] = approx
    history[histKey][-1]['relError'] = relError(expectedSolution, approx)
    history[histKey][-1]['absError'] = absError(expectedSolution, approx)
```
[full code](https://KensieCarr.github.io/Math-4610/Homework2/Problem2.py)

**Last Modified:** September/2018
